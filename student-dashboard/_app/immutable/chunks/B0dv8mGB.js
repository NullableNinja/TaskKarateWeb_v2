import{h as g,N as A,L as q,q as S,M as v,O,P as k,Q as m,R as D}from"./DcTAzX_I.js";import{_ as M}from"./PPVm8Dsz.js";const h=[...` 	
\r\fÂ \v\uFEFF`];function E(e,a,i){var s=e==null?"":""+e;if(a&&(s=s?s+" "+a:a),i){for(var n in i)if(i[n])s=s?s+" "+n:n;else if(s.length)for(var t=n.length,r=0;(r=s.indexOf(n,r))>=0;){var d=r+t;(r===0||h.includes(s[r-1]))&&(d===s.length||h.includes(s[d]))?s=(r===0?"":s.substring(0,r))+s.substring(d+1):r=d}}return s===""?null:s}function P(e,a){return e==null?null:String(e)}function H(e,a,i,s,n,t){var r=e.__className;if(g||r!==i||r===void 0){var d=E(i,s,t);(!g||d!==e.getAttribute("class"))&&(d==null?e.removeAttribute("class"):e.className=d),e.__className=i}else if(t&&n!==t)for(var f in t){var o=!!t[f];(n==null||o!==!!n[f])&&e.classList.toggle(f,o)}return t}const L=Symbol("is custom element"),C=Symbol("is html");function K(e){if(g){var a=!1,i=()=>{if(!a){if(a=!0,e.hasAttribute("value")){var s=e.value;b(e,"value",null),e.value=s}if(e.hasAttribute("checked")){var n=e.checked;b(e,"checked",null),e.checked=n}}};e.__on_r=i,S(i),v()}}function b(e,a,i,s){var n=B(e);g&&(n[a]=e.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&e.nodeName==="LINK")||n[a]!==(n[a]=i)&&(a==="loading"&&(e[O]=i),i==null?e.removeAttribute(a):typeof i!="string"&&I(e).includes(a)?e[a]=i:e.setAttribute(a,i))}function B(e){return e.__attributes??={[L]:e.nodeName.includes("-"),[C]:e.namespaceURI===A}}var _=new Map;function I(e){var a=e.getAttribute("is")||e.nodeName,i=_.get(a);if(i)return i;_.set(a,i=[]);for(var s,n=e,t=Element.prototype;t!==n;){s=k(n);for(var r in s)s[r].set&&i.push(r);n=q(n)}return i}const l=m([]),p=m(null),w=m([]),N="tkStudentSession";if(typeof window<"u"){const e=localStorage.getItem(N);if(e)try{const a=JSON.parse(e);a?.id&&p.set(a)}catch(a){console.warn("Invalid session data:",a)}}async function U(){let e=null;if(typeof window<"u")try{console.debug("students: attempting dynamic import from src/data/students.json");const i=await M(()=>import("./BOKuyZwf.js"),[],import.meta.url);e=i&&(i.default||i)||null,e&&console.debug("students: loaded data via dynamic import (src/data/students.json)")}catch(i){console.debug("students: dynamic import failed:",i&&i.message?i.message:i)}else console.debug("students: skipping dynamic import during SSR");if(!e){const i=["/data/students.json","/assets/data/students.json","/student-dashboard/static/data/students.json","./assets/data/students.json"];for(const s of i)try{console.debug(`students: trying ${s}`);const n=await fetch(s);if(!n.ok){console.debug(`students: ${s} returned ${n.status}`);continue}e=await n.json(),console.debug(`students: loaded data from ${s}`);break}catch(n){console.debug(`students: fetch ${s} failed:`,n&&n.message?n.message:n)}}if(!e){console.error("Failed to load students.json from any known path."),l.set([]),w.set([]);return}const a=e.students||[];j(a),l.set(a),w.set(e.news||[])}function j(e){const a={},i={};e.forEach(s=>{a[s.name]=s,s.displayName&&(a[s.displayName]=s),i[s.id]=s}),e.forEach(s=>{s.buddies||(s.buddies=[]),s.buddies.forEach(n=>{const t=a[n.name];t&&(t.buddies||(t.buddies=[]),t.buddies.some(d=>d.name===s.name||d.name===s.displayName)||t.buddies.push({name:s.displayName||s.name,rank:s.rank,streak:0,status:"Buddy"}))})})}function J(e,a,i,s){const n=s.find(o=>o.id===e),t=s.find(o=>o.id===a);if(!n||!t)return console.error("Cannot send message: sender or recipient not found"),null;const r={fromId:e,toId:a,text:i,timestamp:new Date().toISOString(),read:!1};n.messages||(n.messages=[]),t.messages||(t.messages=[]),n.messages.push(r),t.messages.push(r),n.buddies||(n.buddies=[]),t.buddies||(t.buddies=[]);const d=n.buddies.some(o=>o.name===t.name||o.name===t.displayName),f=t.buddies.some(o=>o.name===n.name||o.name===n.displayName);return d||n.buddies.push({name:t.displayName||t.name,rank:t.rank,streak:0,status:"Buddy"}),f||t.buddies.push({name:n.displayName||n.name,rank:n.rank,streak:0,status:"Buddy"}),r}function c(e){e.friends||(e.friends=[]),e.friendRequestsIncoming||(e.friendRequestsIncoming=[]),e.friendRequestsOutgoing||(e.friendRequestsOutgoing=[])}function Y(e,a){l.update(i=>{const s=i.find(t=>t.id===e),n=i.find(t=>t.id===a);return!s||!n||(c(s),c(n),s.friends.includes(a))||s.friendRequestsOutgoing.includes(a)||n.friendRequestsIncoming.includes(e)||(s.friendRequestsOutgoing.push(a),n.friendRequestsIncoming.push(e)),i})}function G(e,a,i=!1){l.update(s=>{const n=s.find(r=>r.id===e),t=s.find(r=>r.id===a);return!t||!n||(c(t),c(n),n.friendRequestsIncoming=n.friendRequestsIncoming.filter(r=>r!==a),t.friendRequestsOutgoing=t.friendRequestsOutgoing.filter(r=>r!==e),n.friends.includes(a)||n.friends.push(a),t.friends.includes(e)||t.friends.push(e)),s})}function Q(e,a){l.update(i=>{const s=i.find(t=>t.id===e),n=i.find(t=>t.id===a);return!n||!s||(c(n),c(s),s.friendRequestsIncoming=s.friendRequestsIncoming.filter(t=>t!==a),n.friendRequestsOutgoing=n.friendRequestsOutgoing.filter(t=>t!==e)),i})}function V(e,a){l.update(i=>{const s=i.find(t=>t.id===e),n=i.find(t=>t.id===a);return!s||!n||(c(s),c(n),s.friends=s.friends.filter(t=>t!==a),n.friends=n.friends.filter(t=>t!==e)),i})}function z(e,a,i,s=null){l.update(n=>{const t=n.find(d=>d.id===e);if(!t)return n;t.feedInteractions||(t.feedInteractions=[]);const r={id:Date.now()+"-"+Math.random().toString(36).slice(2,9),actorId:a,type:i,text:s,timestamp:new Date().toISOString()};return t.feedInteractions.push(r),n})}function W(e,a){return e.find(i=>i.id===a)}function X(e){p.set(e),typeof window<"u"&&localStorage.setItem(N,JSON.stringify(e))}const Z=D(p,e=>{if(!e)return{unreadMessages:0,badgesCount:0,badgesByLevel:{},assignmentsDue:0,practiceCount:0,daysSinceLastClass:null,attendanceDates:[]};const i=(Array.isArray(e.messages)?e.messages:[]).filter(u=>u.toId===e.id&&!u.read).length,s=Array.isArray(e.badges)?e.badges:[],n=s.length,t=s.reduce((u,R)=>{const y=R.level||"Unknown";return u[y]=(u[y]||0)+1,u},{}),r=Array.isArray(e.assignments)?e.assignments.filter(u=>u.due).length:0,d=Array.isArray(e.practice)?e.practice.length:0;let f=null;if(e.lastClassDate){const u=new Date(e.lastClassDate);isNaN(u.getTime())||(f=Math.floor((Date.now()-u.getTime())/864e5))}const o=Array.isArray(e.attendanceDates)?e.attendanceDates.slice():[];return{unreadMessages:i,badgesCount:n,badgesByLevel:t,assignmentsDue:r,practiceCount:d,daysSinceLastClass:f,attendanceDates:o}});export{H as a,X as b,b as c,p as d,z as e,Z as f,G as g,W as h,J as i,V as j,Q as k,U as l,Y as m,w as n,K as r,l as s,P as t};
